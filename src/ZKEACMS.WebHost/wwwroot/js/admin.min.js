$(function(){function e(e){$("input.select-image",e).popover({trigger:"focus",html:!0,title:"图片预览",content:function(){var e=$(this).val();return e?(0===e.indexOf("~")&&(e=e.replace("~",location.origin)),'<div style="width:244px;"><img class="opacity-dotted" src="'+e+'"/></div>'):null},placement:"bottom"}).trigger("change").parent().addClass("loading")}if($(".accordion-group>a").click(function(){var e="active",t=$(this),i=t.nextAll(".accordion-inner");return t.hasClass(e)?(t.removeClass(e),i.hide(200)):(t.addClass(e),i.show(200)),!1}),$(document).on("click",".cancel",function(){window.history.back()}).on("click",".publish",function(){return!!confirm("确认要发布吗？")}).on("click","input[type=submit]",function(){return $("#ActionType").val($(this).data("value")),!0}).on("click",".input-group .search",function(){var e=$(this);window.top.Easy.ShowUrlWindow({url:e.parent().siblings("input.form-control").data("url"),width:e.parent().siblings("input.form-control").data("width")||.9*window.innerWidth,onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){var n=e.parent().siblings("input.form-control"),o=i.GetSelected();if("object"==typeof o){if(n.val(o.value),o.additional){var a=n.closest("form"),l=n.attr("name").split(".");for(var r in o.additional)if(o.additional.hasOwnProperty(r)){l[l.length-1]=r;var s=l.join(".");$('[name="'+s+'"]',a).val(o.additional[r])}}}else n.val(o);t.close(),n.trigger("change")}),$(this.document).on("click",".confirm",function(){var i=e.parent().siblings("input.form-control");i.val($(this).data("result")),t.close(),i.trigger("change")})}})}).on("click",".form-group select#ZoneId",function(){var e=$(this);if("ZONE-X"!=e.val()){var t="/admin/Layout/SelectZone?layoutId="+$(".hide #LayoutId").val()+"&pageId="+$(".hide #PageId").val()+"&zoneId="+e.val();window.top.Easy.ShowUrlWindow({url:t,width:1e3,title:"选择区域",onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){e.val(i.GetSelected()),t.close()})}})}}).on("click",".custom-style-editor",function(){window.top.Easy.ShowUrlWindow({url:"/admin/StyleEditor/Edit",width:1024,title:"编辑样式",onLoad:function(e){e.addClass("loaded")},isDialog:!1}),$(".WeiWindow.BoxShadow").addClass("StyleEditor")}).on("click",".form-group select.select",function(){var e=$(this);window.top.Easy.ShowUrlWindow({url:e.data("url")+"?selected="+e.val(),width:e.data("width")||800,onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){e.val(i.GetSelected()),t.close(),e.trigger("change")}),$(this.document).on("click",".confirm",function(){e.val($(this).data("result")),t.close(),e.trigger("change")})}})}).on("submit","form",function(){Easy.Block()}),$(".form-group select#ZoneId,.form-group select.select").on("mousedown",!1),$(".form-group select#ZoneId").each(function(){"ZONE-X"==$(this).val()&&$(this).closest(".form-group").hide()}),$.fn.datetimepicker&&$(".Date:not(input[type=hidden])").each(function(){$(this).prop("readonly")||$(this).prop("disabled")||($(this).datetimepicker({locale:"zh-CN",format:$(this).attr("JsDateFormat")}),$(this).closest(".input-group").find(".glyphicon-calendar").click(function(){$(this).closest(".input-group").find("input").focus()}))}),$(document).on("click",".nav.nav-tabs a",function(){return $(this).tab("show"),!1}),$(".nav.nav-tabs").each(function(){var e=!1;$("li",this).each(function(){$(this).hasClass("active")&&($(this).removeClass("active"),$("a",this).tab("show"),e=!0)}),e||($("li:first a",this).tab("show"),location.hash&&$("li a[href='"+location.hash+"']",this).tab("show"))}),$("#StyleClass.form-control").popover({trigger:"focus",html:!0,title:"自定义样式用法",content:function(){for(var e=[{name:"边框",value:"border"},{name:"文字居中",value:"align-center"},{name:"文字右对齐",value:"align-right"},{name:"图片边框",value:"image-border"},{name:"阴影",value:"box-shadow"},{name:"图片圆形",value:"image-circle"},{name:"取消外边距",value:"full"},{name:"居中容器",value:"container"}],t="<p clss='text-nowrap'>直接写样式例：<code>style=\"color:#fff\"</code></p><p>预定义样式：<ol>",i=0;i<e.length;i++)t+="<li>"+e[i].name+":<code>"+e[i].value+"</code></li>";return t+="</ol></p>",t},placement:"bottom"}),$(document).on("change","input.select-image",function(){var e=$(this).val();e&&0!=e.indexOf("~/")&&0!=e.indexOf("/")&&0!=e.replace("http://","").replace("https://","").indexOf(window.location.hostname)?0==$(this).siblings(".image-local").length&&$('<div class="input-group-addon image-local"><span class="glyphicon glyphicon-floppy-open upload-external"></span></div>').insertAfter($(this)):$(this).siblings(".image-local").remove()}),$(document).on("list.added",function(t){e(t.target)}),e(document),$(document).on("click",".image-local .upload-external",function(){var e=$(this).closest(".input-group");e.addClass("processing"),$.post("/admin/Media/DownLoadExternalImage",{images:[e.find("input").val()]},function(t){if(t)for(var i=0;i<t.length;i++)e.find("input").val(t[i].value).trigger("change");e.removeClass("processing")},"json")}),document.addEventListener){function t(e,i,n,o){var a="/admin/media/upload";n>0&&(a="/admin/media/appendfile");var l=n+1e6;l>i.size&&(l=i.size),e.parentNode.classList.add("processing"),e.value="...";var r=new XMLHttpRequest;r.open("POST",a),l==i.size?r.onload=function(t){e.parentNode.classList.remove("processing");var i=JSON.parse(t.target.response);i.id&&(e.value="~"+i.url,$(e).blur().focus())}:r.onload=function(n){var o=JSON.parse(n.target.response);o&&t(e,i,l,o)},r.onerror=function(){e.parentNode.classList.remove("processing"),e.value="Error!"};var s=new FormData;s.append("file",i.slice(n,l),i.name),s.append("folder","Images"),s.append("size",i.size),o&&(s.append("id",o.id),s.append("position",n)),r.send(s)}document.addEventListener("paste",function(e){if(e.target.className&&e.target.className.indexOf("select-image")>=0){var i,n=e.target;if(e.clipboardData?i=e.clipboardData:window.clipboardData&&(i=window.clipboardData),i&&i.items)for(var o=0;o<i.items.length;o++)if(-1!==i.items[o].type.indexOf("image")){var a=i.items[o].getAsFile();t(n,a,0);break}}})}$(document).on("click",".input-group .video-play-icon",function(){var e=$(this).closest(".input-group").find(".form-control").val();e&&(0===e.indexOf("~")&&(e=e.replace("~",location.origin)),Easy.PlayVideo(e))});var i=$("#main-menu");if(i.length>0){var n,o=0;$("a.menu-item",i).each(function(){var e=$(this).attr("href");e&&0===location.pathname.toLocaleLowerCase().indexOf(e.toLowerCase())&&e.length>o&&(n=$(this),o=e.length)}),n&&n.size()&&(n.addClass("active"),n.parent().hasClass("accordion-inner")&&(n.parent().show(),n.parent().prev().addClass("active")));var a=$(".menu-item.active",i).offset().top-i.offset().top,l=document.querySelector("#left-menu");function r(){l.style.height=window.innerHeight-133+"px"}r();var s=window.Scrollbar.init(l);$(window).on("resize",function(){Easy.Processor(r,500)}),a>0&&(s.scrollTop=a/2)}$.fn.select2&&$("select[multiple='multiple']").select2(),$(".dy-editor:visible").trigger("init-editor")});